<div id="photo-screen" class="screen">
  <div class="header">
    <button class="back-btn" onclick="showScreen('home')" title="ホームに戻る">🏠</button>
    <h1>📸 写真管理</h1>
    <div style="width: 40px;"></div>
  </div>

  <div class="form-container">
    <!-- 撮影ボタン -->
    <div style="display: flex; gap: 10px; margin-bottom: 16px;">
      <button onclick="takePhoto()" style="flex: 1; padding: 16px; background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; min-height: 56px;">
        📷 撮影する
      </button>
      <button onclick="pickPhotoFromGallery()" style="flex: 1; padding: 16px; background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; min-height: 56px;">
        🖼️ ギャラリー
      </button>
    </div>
    <input type="file" id="photoCameraInput" accept="image/*" capture="environment" style="display: none;" onchange="handlePhotoCaptured(event)">
    <input type="file" id="photoGalleryInput" accept="image/*" style="display: none;" onchange="handlePhotoCaptured(event)">

    <!-- フィルター -->
    <div class="form-section" style="padding: 12px;">
      <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
        <select id="photoFilterGenba" onchange="onFilterGenbaChange()" style="flex: 1; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; min-width: 120px;">
          <option value="">全ての現場</option>
        </select>
        <button onclick="quickAddGenbaPhoto('photoFilterGenba')" style="padding: 10px 12px; font-size: 13px; font-weight: bold; background: #f59e0b; color: white; border: none; border-radius: 8px; cursor: pointer; white-space: nowrap;">＋新規</button>
        <select id="photoFilterKoutei" onchange="filterPhotos()" style="flex: 1; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; min-width: 120px;">
          <option value="">全ての工程</option>
        </select>
      </div>
      <div style="display: flex; gap: 8px; margin-top: 8px; align-items: center;">
        <select id="photoFilterCategory" onchange="filterPhotos()" style="flex: 1; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;">
          <option value="">全カテゴリ</option>
          <option value="配管工事">配管工事</option>
          <option value="電気工事">電気工事</option>
          <option value="解体工事">解体工事</option>
          <option value="内装工事">内装工事</option>
          <option value="外装工事">外装工事</option>
          <option value="設備搬入">設備搬入</option>
          <option value="完了検査">完了検査</option>
          <option value="その他">その他</option>
        </select>
        <span id="photoCount" style="font-size: 13px; color: #6b7280; white-space: nowrap;">0枚</span>
      </div>
    </div>

    <!-- 写真一覧 -->
    <div id="photoGalleryList" style="margin-top: 12px;">
      <div class="empty-state">
        <div class="empty-state-icon">📷</div>
        <div>写真がありません</div>
        <div style="font-size: 12px; margin-top: 8px;">撮影またはギャラリーから追加してください</div>
      </div>
    </div>
  </div>
</div>

<!-- 写真登録モーダル -->
<div id="photoRegisterModal" class="ocr-loading hidden" style="background: rgba(0,0,0,0.5);">
  <div style="background: white; border-radius: 16px; width: 95%; max-width: 420px; max-height: 90vh; display: flex; flex-direction: column;">
    <div style="padding: 16px; border-bottom: 1px solid #e5e7eb;">
      <h3 style="margin: 0; font-size: 18px;">📸 写真を登録</h3>
    </div>

    <div style="flex: 1; overflow-y: auto; padding: 16px;">
      <!-- プレビュー -->
      <div style="text-align: center; margin-bottom: 16px;">
        <img id="photoPreviewImg" style="max-width: 100%; max-height: 200px; border-radius: 8px; border: 1px solid #e5e7eb;">
      </div>

      <!-- AI分類結果 -->
      <div id="photoAiResult" style="display: none; background: #eff6ff; border: 1px solid #3b82f6; border-radius: 10px; padding: 12px; margin-bottom: 16px;">
        <div style="font-size: 12px; color: #3b82f6; font-weight: bold; margin-bottom: 4px;">🤖 AI自動分類</div>
        <div id="photoAiCategory" style="font-size: 16px; font-weight: bold; color: #1e40af;"></div>
        <div id="photoAiDescription" style="font-size: 12px; color: #6b7280; margin-top: 4px;"></div>
      </div>

      <!-- 現場選択 -->
      <div style="margin-bottom: 12px;">
        <label style="font-size: 13px; color: #374151; font-weight: 500;">現場 *</label>
        <div style="display: flex; gap: 8px; align-items: center; margin-top: 4px;">
          <select id="photoGenbaSelect" onchange="onPhotoGenbaChange()" style="flex: 1; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 15px;">
            <option value="">選択してください</option>
          </select>
          <button onclick="quickAddGenbaPhoto('photoGenbaSelect')" style="padding: 10px 12px; font-size: 13px; font-weight: bold; background: #f59e0b; color: white; border: none; border-radius: 8px; cursor: pointer; white-space: nowrap;">＋新規</button>
        </div>
      </div>

      <!-- 工程選択 -->
      <div style="margin-bottom: 12px;">
        <label style="font-size: 13px; color: #374151; font-weight: 500;">工程（任意）</label>
        <select id="photoKouteiSelect" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 15px; margin-top: 4px;">
          <option value="">選択してください</option>
        </select>
      </div>

      <!-- カテゴリ -->
      <div style="margin-bottom: 12px;">
        <label style="font-size: 13px; color: #374151; font-weight: 500;">カテゴリ</label>
        <select id="photoCategorySelect" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 15px; margin-top: 4px;">
          <option value="配管工事">配管工事</option>
          <option value="電気工事">電気工事</option>
          <option value="解体工事">解体工事</option>
          <option value="内装工事">内装工事</option>
          <option value="外装工事">外装工事</option>
          <option value="設備搬入">設備搬入</option>
          <option value="完了検査">完了検査</option>
          <option value="その他">その他</option>
        </select>
      </div>

      <!-- メモ -->
      <div style="margin-bottom: 12px;">
        <label style="font-size: 13px; color: #374151; font-weight: 500;">メモ</label>
        <textarea id="photoMemoInput" rows="3" placeholder="施工状況のメモを入力..." style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 15px; resize: vertical; margin-top: 4px; box-sizing: border-box;"></textarea>
      </div>
    </div>

    <div style="padding: 12px; border-top: 1px solid #e5e7eb;">
      <div style="display: flex; gap: 8px;">
        <button class="data-btn backup" style="flex: 1;" onclick="closePhotoRegister()">キャンセル</button>
        <button class="save-btn" style="flex: 1; padding: 14px; font-size: 16px;" onclick="saveNewPhoto()">保存する</button>
      </div>
    </div>
  </div>
</div>

<!-- 写真詳細モーダル -->
<div id="photoDetailModal" class="ocr-loading hidden" style="background: rgba(0,0,0,0.5);">
  <div style="background: white; border-radius: 16px; width: 95%; max-width: 420px; max-height: 90vh; display: flex; flex-direction: column;">
    <div style="padding: 16px; border-bottom: 1px solid #e5e7eb; display: flex; justify-content: space-between; align-items: center;">
      <h3 style="margin: 0; font-size: 18px;">📷 写真詳細</h3>
      <button onclick="deleteCurrentPhoto()" style="padding: 6px 12px; background: #fee2e2; color: #dc2626; border: 1px solid #fca5a5; border-radius: 6px; font-size: 12px; cursor: pointer;">🗑 削除</button>
    </div>
    <div style="flex: 1; overflow-y: auto; padding: 16px;">
      <div style="text-align: center; margin-bottom: 12px;">
        <img id="photoDetailImg" style="max-width: 100%; max-height: 300px; border-radius: 8px;">
      </div>
      <div id="photoDetailInfo" style="font-size: 14px; color: #374151;"></div>
      <div style="margin-top: 12px;">
        <label style="font-size: 13px; color: #374151; font-weight: 500;">メモ</label>
        <textarea id="photoDetailMemo" rows="3" style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px; resize: vertical; margin-top: 4px; box-sizing: border-box;"></textarea>
      </div>
    </div>
    <div style="padding: 12px; border-top: 1px solid #e5e7eb;">
      <div style="display: flex; gap: 8px;">
        <button class="data-btn backup" style="flex: 1;" onclick="closePhotoDetail()">閉じる</button>
        <button class="save-btn" style="flex: 1; padding: 14px;" onclick="updatePhotoMemo()">メモ保存</button>
      </div>
    </div>
  </div>
</div>

<!-- AI分析中ローディング -->
<div id="photoAiLoading" class="ocr-loading hidden">
  <div class="ocr-loading-content">
    <div class="loading-spinner"></div>
    <div>🤖 AIが写真を分析中...</div>
  </div>
</div>
