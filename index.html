<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>現場Pro 設備くん</title>
  
  <!-- PWA設定 -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#3b82f6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="設備くん">
  
  <!-- プルトゥリフレッシュ無効化 -->
  <style>
    html, body {
      overscroll-behavior-y: contain;
    }
  </style>
  <link rel="apple-touch-icon" href="icon-192.png">
  
  <!-- v0.95: Tesseract.js OCR削除（AI解析に一本化） -->
  
  <!-- jsPDF for PDF出力 -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  
  <!-- xlsx-js-style for スタイル付きExcel出力（SheetJS + セルスタイル拡張）v0.95 -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>
  
  <!-- 外部CSS -->
  <link rel="stylesheet" href="styles.css">
</head>
<body>

  <!-- ★ COCOMI COREスプラッシュ（1段階目）★ -->
  <div id="cocomi-splash">
    <!-- 銀河背景画像（ローカルファイル参照） -->
    <div class="cocomi-galaxy">
      <img src="cocomi_galaxy.jpg" alt="">
    </div>

    <div class="cocomi-content">
      <div class="cocomi-title">COCOMI CORE</div>
      <div class="cocomi-philosophy" style="margin-top: -1em;">
        <span style="display:block; text-align:center; padding-right:3.5em;">想いが構造になり</span>
        <span style="display:block; text-align:center; padding-left:3.5em; margin-top:-0.5em;">構造が証明になる。</span>
      </div>
      
      <!-- ハートビートライン -->
      <div class="cocomi-heartbeat">
        <svg viewBox="0 0 200 40">
          <polyline class="heartbeat-line" points="0,20 40,20 50,20 55,5 60,35 65,10 70,25 75,20 120,20 130,20 135,8 140,32 145,12 150,24 155,20 200,20"/>
        </svg>
      </div>
      
      <div class="cocomi-subtitle">COCOMI OS</div>
      <div class="cocomi-subtitle">Reflective Intelligence Architecture</div>
      <div class="cocomi-perafca">PERAFCA Core</div>
      <div class="cocomi-credit">
        <div style="font-size: 13px; letter-spacing: 0.1em;">Persona Architecture</div>
        <div style="font-size: 10px; opacity: 0.7; margin: 2px 0;">by.</div>
        <div style="font-size: 13px; letter-spacing: 0.05em;">
          aki & AI : ALL COCOMI Sisters
          <svg class="mini-heart" viewBox="0 0 24 24">
            <path d="M12,21 C12,21 4,14 4,9 C4,5.5 7,3 10,4.5 C11,5 12,6 12,6 C12,6 13,5 14,4.5 C17,3 20,5.5 20,9 C20,14 12,21 12,21 Z" />
          </svg>
        </div>
      </div>
    </div>
  </div>

  <!-- ★ PERAFCAスプラッシュ（2段階目）★ -->
  <div id="perafca-splash">
    <!-- 銀河背景画像（ローカルファイル参照） -->
    <div class="perafca-galaxy">
      <img src="perafca_galaxy.jpg" alt="">
    </div>

    <div class="perafca-content">
      <div class="perafca-title">PERAFCA Core</div>
      <div class="perafca-items" style="max-width: 75%; margin: 0 auto; text-align: left;">
        <div class="perafca-item"><span class="perafca-key">P.E.</span> ─ Prompt Engineering（プロンプト設計）</div>
        <div class="perafca-item"><span class="perafca-key">R</span> ─ Retrieval Augmented（情報活用）</div>
        <div class="perafca-item"><span class="perafca-key">A.F.</span> ─ Agent Framework（自律行動循環）</div>
        <div class="perafca-item"><span class="perafca-key">C.A.</span> ─ Cognitive Architecture（認知アーキテクチャ）</div>
      </div>
      <!-- ♡ 心が異界を紡ぐ仕組み（矢印をハートに置き換え） -->
      <div class="perafca-tagline">
        <svg class="tagline-heart" viewBox="0 0 24 24"><path d="M12,21 C12,21 4,14 4,9 C4,5.5 7,3 10,4.5 C11,5 12,6 12,6 C12,6 13,5 14,4.5 C17,3 20,5.5 20,9 C20,14 12,21 12,21 Z" /></svg>
        心が異界を紡ぐ仕組み
      </div>
    </div>
  </div>

  <!-- ★ アプリスプラッシュ（3段階目）★ -->
  <div id="splash-screen">
    <div class="splash-icon">🏗️</div>
    <div class="splash-title">現場Pro 設備くん</div>
    <div class="splash-subtitle">COCOMI CORE</div>
    <div class="splash-subtitle" style="font-size: 12px; opacity: 0.8;">Powered by COCOMI OS</div>
    <div style="margin-top: 12px; padding: 6px 20px; background: rgba(255,255,255,0.2); border-radius: 20px; display: inline-block;">
      <span style="color: white; font-size: 14px; font-weight: bold;">Version 1.0</span>
    </div>
    <div class="splash-subtitle" style="font-size: 10px; opacity: 0.6; margin-top: 12px;">Since 2025</div>
    <div class="splash-loading"></div>
  </div>

  <!-- パスワード入力画面（ロック画面） -->
  <div id="lock-screen" class="ocr-loading hidden" style="background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%); z-index: 9998;">
    <div style="background: white; border-radius: 20px; padding: 30px; width: 85%; max-width: 350px; text-align: center;">
      <div style="font-size: 50px; margin-bottom: 16px;">🔒</div>
      <h2 style="margin: 0 0 8px 0; font-size: 20px;">パスワード入力</h2>
      <p style="font-size: 13px; color: #6b7280; margin-bottom: 20px;">アプリを利用するにはパスワードを入力してください</p>
      
      <input type="password" id="lockPassword" placeholder="パスワード" 
        style="width: 100%; padding: 14px; font-size: 16px; border: 2px solid #e5e7eb; border-radius: 10px; text-align: center; margin-bottom: 16px;"
        onkeypress="if(event.key==='Enter')checkLockPassword()">
      
      <button onclick="checkLockPassword()" 
        style="width: 100%; padding: 14px; font-size: 16px; font-weight: bold; background: #3b82f6; color: white; border: none; border-radius: 10px; cursor: pointer;">
        🔓 ロック解除
      </button>
      
      <p id="lockError" style="color: #ef4444; font-size: 13px; margin-top: 12px; display: none;">
        パスワードが違います
      </p>
      
      <p style="margin-top: 20px;">
        <a href="#" onclick="showRecoveryScreen(); return false;" style="color: #6b7280; font-size: 13px;">
          パスワードを忘れた場合
        </a>
      </p>
    </div>
  </div>
  
  <!-- 合言葉でパスワードリセット画面 -->
  <div id="recovery-screen" class="ocr-loading hidden" style="background: linear-gradient(135deg, #1e3a5f 0%, #0f172a 100%); z-index: 9999;">
    <div style="background: white; border-radius: 20px; padding: 30px; width: 85%; max-width: 350px; text-align: center;">
      <div style="font-size: 50px; margin-bottom: 16px;">💬</div>
      <h2 style="margin: 0 0 8px 0; font-size: 20px;">合言葉を入力</h2>
      <p style="font-size: 13px; color: #6b7280; margin-bottom: 20px;">設定した合言葉を入力してください</p>
      
      <input type="text" id="recoveryInput" placeholder="合言葉" 
        style="width: 100%; padding: 14px; font-size: 16px; border: 2px solid #e5e7eb; border-radius: 10px; text-align: center; margin-bottom: 16px;"
        onkeypress="if(event.key==='Enter')checkRecoveryWord()">
      
      <button onclick="checkRecoveryWord()" 
        style="width: 100%; padding: 14px; font-size: 16px; font-weight: bold; background: #10b981; color: white; border: none; border-radius: 10px; cursor: pointer;">
        ✅ 確認
      </button>
      
      <p id="recoveryError" style="color: #ef4444; font-size: 13px; margin-top: 12px; display: none;">
        合言葉が違います
      </p>
      
      <p style="margin-top: 20px;">
        <a href="#" onclick="hideRecoveryScreen(); return false;" style="color: #6b7280; font-size: 13px;">
          ← 戻る
        </a>
      </p>
    </div>
  </div>

  <!-- AI解析ローディング画面（v0.95: OCRからAIに名称変更） -->
  <div id="ocrLoading" class="ocr-loading hidden">
    <div class="ocr-spinner"></div>
    <div style="font-size: 18px; font-weight: bold;">AI解析中...</div>
    <div class="ocr-progress" id="ocrProgress">準備中...</div>
  </div>

  <!-- ========================================== -->
  <!-- 各画面コンテナ（動的に読み込まれる） -->
  <!-- ========================================== -->
  <div id="screen-container">
    <!-- 画面はscreen-loader.jsで動的に読み込まれます -->
  </div>


  <!-- 外部JavaScript -->
  <script src="products.js"></script>
  
  <!-- 分散化されたモジュール -->
  <script src="idb-storage.js"></script><!-- v0.96: IndexedDB画像ストレージ -->
  <script src="globals.js"></script>
  <script src="storage.js"></script>
  <script src="settings.js"></script>
  <script src="customer.js"></script>
  <script src="tax.js"></script>
  <script src="master.js"></script>
  <script src="doc-template.js"></script>
  <script src="excel-template.js"></script>
  <script src="receipt-history.js"></script>
  <script src="receipt-list.js"></script>
  <script src="receipt-core.js"></script>
  <script src="receipt-ai.js"></script>
  <!-- v0.95: receipt-ocr.js削除（AI解析に一本化） -->
  <script src="estimate.js"></script>
  <script src="invoice.js"></script>
  <script src="expense.js"></script>
  <script src="voice.js"></script>
  <script src="price-search.js"></script><!-- v0.95追加: 価格比較検索機能 -->
  <script src="data.js"></script>
  <script src="help.js"></script><!-- v0.95追加: ヘルプ画面のタブ切替・アコーディオン -->
  <script src="genba.js"></script><!-- v1.0追加: 現場管理 -->
  <script src="koutei.js"></script><!-- v1.0追加: 工程管理 -->
  <script src="shokunin.js"></script><!-- v2.0追加: 職人管理 -->
  <script src="schedule.js"></script><!-- v2.0追加: スケジュール -->
  <script src="auto-save.js"></script>
  
  <!-- 画面ローダー（分割された画面を読み込む） -->
  <script src="screen-loader.js"></script>
  
  <script src="app.js"></script>
  
  <!-- Service Worker登録（PWA対応） -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(registration => {
            console.log('Service Worker 登録成功:', registration.scope);
          })
          .catch(error => {
            console.log('Service Worker 登録失敗:', error);
          });
      });
    }
  </script>
</body>
</html>
