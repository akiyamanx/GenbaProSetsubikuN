<!-- v0.53改修 - Phase5-3 ガントチャート風スケジュール画面 -->
<div id="schedule-screen" class="screen">
  <div class="header" style="background: linear-gradient(135deg, #7c3aed, #5b21b6);">
    <button class="back-btn" onclick="showScreen('home')">←</button>
    <h1>📅 スケジュール</h1>
    <button class="header-btn" onclick="openScheduleForm()">＋</button>
  </div>

  <!-- 現場フィルター＆マイスケジュールリンク -->
  <div style="display:flex; gap:8px; padding:12px 16px 0; align-items:center;">
    <select id="schedule-genba-filter" onchange="onScheduleGenbaFilterChange()" style="flex:1; padding:10px; font-size:14px; border:2px solid #ddd; border-radius:8px; background:white;">
      <option value="">全ての現場</option>
    </select>
    <button onclick="showScreen('my-schedule')" style="padding:10px 12px; font-size:13px; font-weight:bold; background:#7c3aed; color:white; border:none; border-radius:8px; cursor:pointer; white-space:nowrap;">📅 My</button>
  </div>

  <!-- 月ナビゲーション -->
  <div style="display:flex; align-items:center; justify-content:center; gap:16px; padding:12px 16px;">
    <button onclick="prevMonth()" style="width:44px; height:44px; border:none; border-radius:50%; background:#f3f4f6; font-size:20px; cursor:pointer; font-weight:bold;">◀</button>
    <div id="schedule-month-label" style="font-size:20px; font-weight:bold; color:#1f2937; min-width:160px; text-align:center;">2026年2月</div>
    <button onclick="nextMonth()" style="width:44px; height:44px; border:none; border-radius:50%; background:#f3f4f6; font-size:20px; cursor:pointer; font-weight:bold;">▶</button>
    <button onclick="goToday()" style="padding:8px 14px; border:1px solid #7c3aed; border-radius:20px; background:white; font-size:13px; font-weight:bold; color:#7c3aed; cursor:pointer;">今日</button>
  </div>

  <!-- ガントチャートカレンダー -->
  <div id="schedule-calendar" style="padding:0 8px;">
    <div style="text-align:center; padding:40px; color:#9ca3af;">読み込み中...</div>
  </div>

  <!-- 凡例 + 工種追加ボタン -->
  <div style="margin:8px;">
    <div id="schedule-legend" class="gantt-legend" style="display:none;"></div>
    <div id="schedule-legend-add" style="margin-top:6px; display:none;">
      <button class="gantt-legend-add-btn" onclick="openCustomCategoryModal()">＋ 工種を追加</button>
    </div>
  </div>

  <!-- v5.4追加 - 工種追加モーダル -->
  <div id="custom-category-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:200; overflow-y:auto;">
    <div style="background:white; margin:40px auto; max-width:400px; border-radius:16px; overflow:hidden;">
      <div style="background:linear-gradient(135deg, #7c3aed, #5b21b6); color:white; padding:16px; display:flex; justify-content:space-between; align-items:center;">
        <h2 style="font-size:18px; margin:0;">工種を追加</h2>
        <button onclick="closeCustomCategoryModal()" style="background:rgba(255,255,255,0.2); border:none; color:white; width:36px; height:36px; border-radius:50%; font-size:18px; cursor:pointer;">✕</button>
      </div>
      <div style="padding:20px;">
        <label style="display:block; font-weight:bold; margin-bottom:6px; font-size:14px; color:#374151;">工種名 *</label>
        <input type="text" id="custom-cat-name" placeholder="例: 防水工事" style="width:100%; padding:14px; font-size:16px; border:2px solid #e5e7eb; border-radius:10px; margin-bottom:16px;">

        <label style="display:block; font-weight:bold; margin-bottom:6px; font-size:14px; color:#374151;">色</label>
        <div id="custom-cat-presets" class="color-preset-grid"></div>
        <div class="color-picker-row">
          <input type="color" id="custom-cat-color" value="#607D8B">
          <span id="custom-cat-color-hex" class="color-hex">#607D8B</span>
        </div>

        <button onclick="saveCustomCategoryForm()" style="width:100%; padding:16px; font-size:18px; font-weight:bold; background:linear-gradient(135deg, #7c3aed, #5b21b6); color:white; border:none; border-radius:12px; cursor:pointer;">
          保存する
        </button>
      </div>
    </div>
  </div>

  <!-- 日詳細パネル -->
  <div id="schedule-day-detail" style="padding:8px 16px 100px; display:none;"></div>

  <!-- スケジュール登録モーダル -->
  <div id="schedule-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:200; overflow-y:auto;">
    <div style="background:white; margin:20px auto; max-width:500px; border-radius:16px; overflow:hidden;">
      <div style="background:linear-gradient(135deg, #7c3aed, #5b21b6); color:white; padding:16px; display:flex; justify-content:space-between; align-items:center;">
        <h2 id="schedule-modal-title" style="font-size:18px; margin:0;">予定を追加</h2>
        <button onclick="closeScheduleModal()" style="background:rgba(255,255,255,0.2); border:none; color:white; width:36px; height:36px; border-radius:50%; font-size:18px; cursor:pointer;">✕</button>
      </div>
      <div style="padding:20px;">
        <input type="hidden" id="schedule-edit-id">

        <label style="display:block; font-weight:bold; margin-bottom:6px; font-size:14px; color:#374151;">開始日 *</label>
        <input type="date" id="schedule-date" style="width:100%; padding:14px; font-size:16px; border:2px solid #e5e7eb; border-radius:10px; margin-bottom:12px;">

        <label style="display:block; font-weight:bold; margin-bottom:6px; font-size:14px; color:#374151;">終了日</label>
        <input type="date" id="schedule-end-date" style="width:100%; padding:14px; font-size:16px; border:2px solid #e5e7eb; border-radius:10px; margin-bottom:16px;">

        <label style="display:block; font-weight:bold; margin-bottom:6px; font-size:14px; color:#374151;">現場</label>
        <select id="schedule-genba" style="width:100%; padding:14px; font-size:16px; border:2px solid #e5e7eb; border-radius:10px; margin-bottom:16px; background:white;" onchange="onScheduleGenbaChange()">
          <option value="">-- 現場を選択 --</option>
        </select>

        <label style="display:block; font-weight:bold; margin-bottom:6px; font-size:14px; color:#374151;">工程</label>
        <select id="schedule-koutei" style="width:100%; padding:14px; font-size:16px; border:2px solid #e5e7eb; border-radius:10px; margin-bottom:16px; background:white;">
          <option value="">-- 工程を選択 --</option>
        </select>

        <label style="display:block; font-weight:bold; margin-bottom:6px; font-size:14px; color:#374151;">職人</label>
        <select id="schedule-shokunin" style="width:100%; padding:14px; font-size:16px; border:2px solid #e5e7eb; border-radius:10px; margin-bottom:16px; background:white;">
          <option value="">-- 職人を選択 --</option>
        </select>

        <label style="display:block; font-weight:bold; margin-bottom:6px; font-size:14px; color:#374151;">メモ</label>
        <textarea id="schedule-memo" placeholder="備考など" rows="2" style="width:100%; padding:14px; font-size:16px; border:2px solid #e5e7eb; border-radius:10px; margin-bottom:20px; resize:vertical;"></textarea>

        <button id="schedule-save-btn" style="width:100%; padding:16px; font-size:18px; font-weight:bold; background:linear-gradient(135deg, #7c3aed, #5b21b6); color:white; border:none; border-radius:12px; cursor:pointer;">
          保存する
        </button>
      </div>
    </div>
  </div>
</div>
